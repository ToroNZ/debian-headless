name: 'Build Debian ISO'

on:
  workflow_dispatch:

jobs:
  build-debian-iso:
    runs-on: ubuntu-latest
    env:
      SOURCE: debian-12.5.0-amd64-DVD-1.iso
      TARGET: debian-12.5.0-amd64-unnattended.iso
      ARCH: amd64
      LABEL: debian
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: make install-depends
      - name: Download ISO
        run: curl -LOs https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/${SOURCE}
      - name: Make ISO
        run: make image 
      - name: Upload ISO
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.LABEL }}-${{ env.ARCH }}-iso
          path: ${{ env.TARGET }}
          overwrite: true
